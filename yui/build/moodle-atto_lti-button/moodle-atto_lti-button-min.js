YUI.add("moodle-atto_lti-button",function(n,t){n.namespace("M.atto_lti").COMPONENTNAME="atto_lti",n.namespace("M.atto_lti").Button=n.Base.create("button",n.M.editor_atto.EditorPlugin,[],{_currentSelection:null,_courseID:1,initializer:function(){this._courseID=this.get("courseid"),this.addButton({icon:"icon",iconComponent:"atto_lti",callback:this._displayDialogue,tags:".lti-placeholder",tagMatchRequiresAll:!1,inlineFormat:!0,keys:"66"}),this.editor.all(".lti-placeholder").setAttribute("contenteditable","false"),this.editor.delegate("dblclick",this._handleDblClick,".lti-placeholder",this),this.editor.delegate("click",this._handleClick,".lti-placeholder",this)},_displayDialogue:function(){var i,a;this._currentSelection=this.get("host").getSelection(),!1!==this._currentSelection&&(i=this.getDialogue({headerContent:M.util.get_string("pluginname",n.M.atto_lti.COMPONENTNAME),width:"auto",focusAfterHide:!0}),n.M.atto_lti.Dialogue.setDialogueContent(a=this,function(t){i.set("bodyContent",t).show(),t.all(n.M.atto_lti.CSS_SELECTORS.LTI_SELECTOR).each(function(e){e.on("click",function(t){t.preventDefault(),a._setLTI(Number.parseInt(e.getData().value)),i.close()},a)})}))},_getLTIDiv:function(){var t=this.get("host").getSelectedNodes(),e=null;return t.each(function(t){t.hasClass("lti-placeholder")&&(e=t)}),e},_setLTI:function(a){var l,t=this._getLTIDiv(),o=this.get("host");o.focus(),t&&t.remove(),o.setSelection(this._currentSelection),l=this,require(["core/ajax","core/notification"],function(t,e){var i={typeid:a,instanceid:12345,courseid:l.getCourseID()};t.call([{methodname:"atto_lti_fetch_param",args:i}])[0].then(function(t){var e=n.Handlebars.compile(n.M.atto_lti.LTI_TEMPLATE),t=e(t);o.insertContentAtFocusPoint(t),l.markUpdated()})["catch"](e.exception)})},_handleClick:function(t){t=this.get("host").getSelectionFromNode(t.target);this.get("host").getSelection()!==t&&this.get("host").setSelection(t)},_handleDblClick:function(){this._displayDialogue()},getCourseID:function(){return this._courseID}},{ATTRS:{langs:{value:["Default","Value"]},courseid:{value:1}}}),n.namespace("M.atto_lti").Dialogue={setDialogueContent:function(i,a){require(["core/ajax","core/notification"],function(t,e){return t.call([{methodname:"mod_lti_get_tool_types",args:{}}])[0].then(function(t){var e=n.Handlebars.compile(n.M.atto_lti.FORM_TEMPLATE),t=n.Node.create(e({elementid:i.get("host").get("elementid"),CSS:n.M.atto_lti.CSS_SELECTORS,component:n.M.atto_lti.COMPONENTNAME,ltitypes:t}));a(t)})["catch"](e.exception)})}},n.namespace("M.atto_lti").LTI_TEMPLATE='{{#if addParagraphs}}<p><br></p>{{/if}}<div class="lti-placeholder" contenteditable="false"><iframe id="contentframe" height="600px" width="100%" src="{{launchurl}}" allow="microphone {{ltiallowurl}}; camera {{ltiallowurl}}; geolocation {{ltiallowurl}}; midi {{ltiallowurl}}; encrypted-media {{ltiallowurl}}; autoplay {{ltiallowurl}} " allowfullscreen="1"><div class="att-lti-login-info">{{#loginparameters}}<div class="d-none" data-name="{{key}}" data-value="{{value}}"></div> {{/loginparameters}}</div></iframe></div>{{#if addParagraphs}}<p><br></p>{{/if}}',n.namespace("M.atto_lti").FORM_TEMPLATE='<div class="atto_form mform d-flex" id="{{elementid}}_atto_lti_form">{{#ltitypes}}<a class="lti-atto-item card m-1" data-value="{{id}}" href="#"><img class="card-img-top" src="{{urls.icon}}"><div class="card-body"><div class="card-title"><h5 class="card-title">{{name}}</h5><p class="card-text">{{description}}</p></div></div></a>{{/ltitypes}}</div>',n.namespace("M.atto_lti").CSS_SELECTORS={LTI_SELECTOR:".lti-atto-item"}},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});