YUI.add("moodle-atto_lti-button",function(o,t){o.namespace("M.atto_lti").COMPONENTNAME="atto_lti",o.namespace("M.atto_lti").Button=o.Base.create("button",o.M.editor_atto.EditorPlugin,[],{initializer:function(){this.addButton({icon:"icon",iconComponent:"atto_lti",callback:this._displayDialogue,tags:".lti-placeholder",tagMatchRequiresAll:!1,inlineFormat:!0,keys:"66"}),this.editor.all(".lti-placeholder").setAttribute("contenteditable","false")},_displayDialogue:function(){var e,t,i;this._currentSelection=this.get("host").getSelection(),!1!==this._currentSelection&&(e=this._getLTIDiv(),t=this.getDialogue({headerContent:M.util.get_string("pluginname",o.M.atto_lti.COMPONENTNAME),width:"auto",focusAfterHide:!0}),i=o.M.atto_lti.Dialogue.getDialogueContent(this),t.set("bodyContent",i).show(),M.form.shortforms({formid:this.get("host").get("elementid")+"_atto_lti_form"}),this._setLTI(e),i.one("."+o.M.atto_lti.CSS_SELECTORS.INPUTSUBMIT).on("click",function(t){t.preventDefault(),this._setLTI(e)},this))},_getLTIDiv:function(){var t=this.get("host").getSelectedNodes(),e=null;return t.each(function(t){t.hasClass("lti-placeholder")&&(e=t)}),e},_setLTI:function(t){var i=this.get("host");i.focus(),t&&t.remove(),o.io(M.cfg.wwwroot+"/lib/ajax/service.php",{method:"POST",data:JSON.encode({sesskey:M.cfg.sesskey,typeid:1,instanceid:1}),context:this,on:{complete:function(t,e){e=o.Handlebars.compile(o.M.atto_lti.LTI_TEMPLATE,JSON.decode(e.responseText)),e=e({});i.insertContentAtFocusPoint(e),this.markUpdated()}}})}},{ATTRS:{langs:{value:["Default","Value"]}}}),o.namespace("M.atto_lti").Dialogue={getDialogueContent:function(t){var e=o.Handlebars.compile(o.M.atto_lti.FORM_TEMPLATE),t=o.Node.create(e({elementid:t.get("host").get("elementid"),CSS:CSS,component:o.M.atto_lti.COMPONENTNAME}));return t}},o.namespace("M.atto_lti").LTI_TEMPLATE='{{#if addParagraphs}}<p><br></p>{{/if}}<div class="lti-placeholder" contenteditable="false"><iframe id="contentframe" height="600px" width="100%" src="{{launchur}}" allow="microphone {{ltiallowurl}}; camera {{ltiallowurl}}; geolocation {{ltiallowurl}}; midi {{ltiallowurl}}; encrypted-media {{ltiallowurl}}; autoplay {{ltiallowurl}} " allowfullscreen="1"><form action="{{ltiinitiatelogin}}" name="ltiInitiateLoginForm" id="ltiInitiateLoginForm" method="post"   encType="application/x-www-form-urlencoded">  {{#ltiparameters}}   <input type ="hidden" name="{{key}}" value="{{value}}">  {{/ltiparameters}}</form><script type="text/javascript"> document.ltiInitiateLoginForm.submit();<\/script><script type="text/javascript">YUI().use("node", "event", function(Y) {  var doc = Y.one("body");  var frame = Y.one("#contentframe");  var padding = 15; var lastHeight; var resize = function() { var viewportHeight = doc.get("winHeight");   if(lastHeight !== Math.min(doc.get("docHeight"), viewportHeight)){      frame.setStyle("height", viewportHeight - frame.getY() - padding + "px");       lastHeight = Math.min(doc.get("docHeight"), doc.get("winHeight"));  }}; resize(); Y.on("windowresize", resize);   });<\/script></div>{{#if addParagraphs}}<p><br></p>{{/if}}',o.namespace("M.atto_lti").FORM_TEMPLATE='<form class="atto_form mform" id="{{elementid}}_atto_lti_form"></form>',o.namespace("M.atto_lti").CSS_SELECTORS={INPUTSUBMIT:"atto_lti_entrysubmit"}},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});